#!/usr/bin/env gura
sys.stdout.addcr(false)

print_func(func:function) = printf('%s = %s\n', func, func.expr)

tester(test:expr):map:dynamic_scope:void = {
	printf('%s .. ', test)
	try {
		printf('%s\n', test.eval()):nomap
	} catch {|e|
		println(e.text)
	}
}

I(filename:string) = path.join(sys.datadir, 'sample/resource', filename)

_idxTestCase = 0
testcase(title?:string):void {`block} = {
	printtitle(_idxTestCase, title)
	_idxTestCase += 1
	println()
	try {
		scope {|block|}
	} catch {|e|
		println('Error in the test case: ', e.text)
	}
}

printtitle(idx:number, title?:string) = {
	(idx > 0) && println()
	printf('======== #%d', idx + 1)
	title && !title.isempty() && printf(' %s', title)
	println(' ========')
}

getindex() = _idxTestCase
