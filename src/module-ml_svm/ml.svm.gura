#!/usr/bin/env gura
import(re)
import(ml.svm):binary:mixin_type {*}

parse_line(str:string) = {
	fields = str.strip().splitreg(r'\s+'):list
	label = fields[0].tonumber():raise
	x = fields[1..].each():xlist {|field|
		pair = field.split(':'):list
		if (pair.len() >= 2) {
			[int(pair[0]), pair[1].tonumber():raise]
		}
	}
	[label, feature(x)]
}

problem.read(src:stream) = {
	readlines(src).each {|line|
		[label, feature_] = parse_line(line)
		this.add_sample(label, feature_)
	}
}
