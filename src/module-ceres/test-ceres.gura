#!/usr/bin/env gura
import(helper.test) {*}
import(ceres)
import(arrayutil)

testcase() {
	CostFunctionEx = class(ceres.CostFunction) {
		__init__() = {|1, 1|}
		Evaluate(x:array) = [
			array@double {10 - x[0]}	// residual
			array@double {{-1}}			// diff of residual
		]
	}
	costFunc = CostFunctionEx()
	println(costFunc)
	problem = ceres.Problem()
	x = array@double {0.5}
	problem.AddResidualBlock(costFunc, nil, x)
	options = ceres.Solver$Options()
	options.minimizer_progress_to_stdout = true
	summary = ceres.Solver$Summary()
	ceres.Solve(options, problem, summary)
	println(x)
}
sys.exit()
testcase('ceres.CostFunction') {
	ceres.CostFunction() {|costFunction|
		println(costFunction)
	}
}
testcase('ceres.LossFunction') {
	ceres.LossFunction() {|lossFunction|
		println(lossFunction)
	}
}
testcase('ceres.Problem') {
	println(ceres.Problem.AddResidualBlock)
	ceres.Problem() {|problem|
		println(problem)
	}
}
testcase('ceres.Solver$Options') {
	ceres.Solver$Options() {|options|
		println(options)
	}
}
testcase('ceres.Solver$Summary') {
	ceres.Solver$Summary() {|summary|
		println(summary)
	}
}
testcase {
	//ceres.sample@helloworld()
	//ceres.sample@helloworld_analytic_diff()
}
