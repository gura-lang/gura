#!/usr/bin/env gura
import(gmp)
import(testutil) {*}

TestUnaryOperators(ops[]:symbol, value) = {
	operator(ops) {|op|
		try {
			result = op(value).tostring()
		} catch {|e|
			result = e.text
		}
		printf('%s%s .. %s\n', op.symbol, value, result)
	}
}
TestBinaryOperators(ops[]:symbol, valueL, valueR) = {
	operator(ops) {|op|
		try {
			result = op(valueL, valueR).tostring()
		} catch {|e|
			result = e.text
		}
		printf('%s %s %s .. %s\n', valueL, op.symbol, valueR, result)
	}
}
testcase('declaration') {
	tests = [
		`gmp.mpz(0)
		`gmp.mpq(0)
		`gmp.mpf(0)
		`0L
		`0Lr
		`0.L
		`gmp.mpz(1)
		`gmp.mpq(1)
		`gmp.mpf(1)
		`1L
		`1Lr
		`1.L
		`gmp.mpz(-1)
		`gmp.mpq(-1)
		`gmp.mpf(-1)
		`(-1L)
		`(-1Lr)
		`(-1.L)
		`gmp.mpz(314)
		`gmp.mpq(314)
		`gmp.mpf(314)
		`314L
		`314Lr
		`314.L
		`gmp.mpz('314')
		`gmp.mpq('314')
		`gmp.mpf('314')
		`'314'.mpz()
		`'314'.mpq()
		`'314'.mpf()
		`3.14L
		//`3.14Lr
		`123456789012345678901234567890123456789012345678901234567890L
		`123456789012345678901234567890123456789012345678901234567890Lr
		`0777777
		`0b10101010
		`0xffffffff
	]
	tester(tests)
}
testcase('unary operators') {
	ops = [
		`+, `-, `~, `!, `.., `?
	]
	println('---')
	TestUnaryOperators(ops, 3L)
	println('---')
	TestUnaryOperators(ops, -3L)
}
testcase('binary operators') {
	ops = [
		`+, `-, `*, `/, `%, `**,
		`==, `<, `>, `<=, `>=, `<=>, `in,
		`&, `|, `^, `<<, `>>, `||, `&&, `=>
	]
	println('---')
	TestBinaryOperators(ops, 3L, 4)
	println('---')
	TestBinaryOperators(ops, 3L, 4L)
	println('---')
	TestBinaryOperators(ops, 3.L, 4)
	println('---')
	TestBinaryOperators(ops, 3L, 4L)
}
testcase('zero-division') {
	ops = [`/, `%]
	println('---')
	TestBinaryOperators(ops, 3L, 0L)
	println('---')
	TestBinaryOperators(ops, 3L, 0)
	println('---')
	TestBinaryOperators(ops, 3, 0L)
	println('---')
	TestBinaryOperators(ops, 3.L, 0L)
	println('---')
	TestBinaryOperators(ops, 3.L, 0)
	println('---')
	TestBinaryOperators(ops, 3, 0.L)
}
