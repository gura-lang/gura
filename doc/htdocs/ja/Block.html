<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gura Programming Language</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <a href="/"><img src="/images/banner-medium.png" alt="Gura Programming Language/" /></a>
        <p></p>
        <p>
        <a href="../en/Block.html" class="radio-off" style="margin-left: 1em">English</a> |
        <a href="../ja/Block.html" class="radio-on">Japanese</a>
        </p>
        <p class="view"><a href="/">Top Page</a></p>
        <p class="view"><a href="/ja/Download.html">Download</a></p>
        <p class="view"><a href="/ja/Install.html">Install</a></p>
        <p class="view"><a href="/ja/Gallery.html">Gallery</a></p>
        <!--
        <ul>
          <li><a href="https://github.com/jxg/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jxg/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jxg">View On <strong>GitHub</strong></a></li>
        </ul>
        -->
      </header>
      <section>
<!-- ====================================================================== -->

<h2>ブロック式</h2>

<p>
制御構文などの表記を可能にするため、ブロック式の概念を導入しています。 if や while などの構文や、クラス宣言、リスト・辞書要素の初期化表記も、すべてこの機構を使って実装されています。
</p>

<pre><code>f(x:number) {block} = {
    block(x)
    block(x + 1)
    block(x + 2)
}
</code></pre>

<p>
呼び出し方は以下のようになります。
</p>

<pre><code>f(2) {|x|
    print(x)
} # 234
</code></pre>

<p>
ブロック自体は特殊な変数スコープを持たせた関数オブジェクトで、ブロックパラメータは単に関数への引数になります。ブロックパラメータの操作が周囲に影響を与えることはありません。また、通常の関数オブジェクトで定義できる引数設定 (オプション引数・デフォルト値・可変長引数など) は、ブロックパラメータでも有効です。
</p>

<pre><code>x = 0
f(2) {|x|         # dummy arguments are completely isolated from outside
    print(x)
}
println(x)        # 0
</code></pre>

<p>
ブロックを表すシンボルは何でもかまいません。
</p>

<pre><code>f(x:number) {yield} = {
    yield(x)
    yield(x + 1)
    yield(x + 2)
}
</code></pre>

<p>
シンボルの後にクエスチョンマークをつけたブロックは、オプショナルとして扱われます。この場合、ブロックをつけないで関数を実行すると nil に設定されます。
</p>

<pre><code>f_opt() {block?} = {
    if (block == nil) {
        println('not specified')
    } else {
        block()
    }
}

f_opt() # print 'not specified'

f_opt() {
    println('message from block')
}       # print 'message from block'
</code></pre>

<p>
ブロックは通常、それを実行している関数の「外側」の環境にアクセスできる変数スコープで動作します (「外側」とはレキシカルスコープのそれになりますが、ダイナミックスコープに切り替えることもできます)。関数外部の変数の値を変更することができます。
</p>

<pre><code>g() {block} = {
    block()
}

n = 2
g() {
    n = 5
}
printf('n = %d\n', n) # n = 5
</code></pre>

<p>
ブロックシンボルにアトリビュート :inside_scope をつけると、関数内部のスコープに切り替わり、関数の内部処理で設定される変数などにアクセスできるようになります。関数外部の変数は、参照できた値に対しての改変が可能です。
</p>

<pre><code>h() {block:inside_scope} = {
    m = 'local in h()'
    block()
}

h() {
    printf('%s\n', m)    # h()'s local variable m is accessible
}

n = 2
h() {
    n = 5
}
printf('n = %d\n', n)    # n = 2

h() {
    n += 5
}
printf('n = %d\n', n)    # n = 7
</code></pre>

<p>
quoted value にしたブロックを設定した変数を {|..|} で囲って関数に渡すと、それがブロック本体として扱われます。ブロックパラメータも記述できます。例えば:
</p>

<pre><code>f() {block} = {
    block(1, 2, 3, 4)
}
</code></pre>

<p>
という関数があった場合、以下のふたつの呼び出しは等価です。
</p>

<pre><code>block = `{|a, b, c, d|
    printf('%d %d %d %d\n', a, b, c, d)
}
f() {|block|}

f() {|a, b, c, d|
    printf('%d %d %d %d\n', a, b, c, d)
}
</code></pre>

<p>
ブロックは通常、関数オブジェクトとして扱われますが、シンボルの先頭にバッククオートをつけると quoted value として渡されます。これと、先に示した quoted value をブロック本体として渡す機能を使うと、ブロックの delegation ができます。
</p>

<pre><code>f(x:number) {`block} = {
    repeat(x) {|block|}
}
</code></pre>

<!-- ====================================================================== -->
      </section>
      <footer>
        <a href="http://sourceforge.jp/">
        <img src="http://sourceforge.jp/sflogo.php?group_id=5586&type=2" alt="SourceForge.JP" />
        </a>
        <!--
        <p>This project is maintained by <a href="https://github.com/jxg">jxg</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
        -->
      </footer>
    </div>
    <script src="/javascripts/scale.fix.js"></script>
  </body>
</html>
