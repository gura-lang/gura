<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link href="../stylesheet.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" href="http://gura.sourceforge.jp/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://gura.sourceforge.jp/favicon.ico" type="image/vnd.microsoft.icon" />
<title>Gura Programming Language</title>
<meta name="keywords" content="programming, language, interpreter, mapping, gura,
implicit mapping, member mapping">
</head>
<body>
<div>
<a href="../index.html.ja"><img src="../images/banner.png" style="border: none" /></a>
<a href="../en/Block.html" class="radio-off" style="margin-left: 1em">English</a> |
<a href="../ja/Block.html" class="radio-on">Japanese</a>
<span style="margin-left: 3em"><a href="http://sourceforge.jp/">
<img src="http://sourceforge.jp/sflogo.php?group_id=5586&type=3" width="210" height="63" border="0" alt="SourceForge.JP" />
</a></span>
</div>

<div style="color: white; background: #888888; margin-top: 1em; font-weight: bold">
<span style="margin-left: 1em">Copyright (c) 2011-2012 <a href="mailto:pxn11432@nifty.com" style="color:white">Yutaka Saito</a></span>
</div>
<div style="height:.2em; background: #cccccc"></div>
<table cellspacing="0" border="0" width="100%">
<tr>
<td valign="top" class="menu">
<div class="menuitem"><a href="/" class="menuitem">トップページ</a></div>
<div class="menuitem"><a href="Download.html" class="menuitem">ダウンロード</a></div>
<div class="menuitem"><a href="Install.html" class="menuitem">インストール</a></div>
<div class="menuitem"><a href="Gallery.html" class="menuitem">ギャラリー</a></div>
<div class="menuitem"><a href="http://sourceforge.jp/forum/forum.php?forum_id=25531" class="menuitem">Gura 掲示板</a></div>
</td>

<td valign="top" class="description">
<!-- ====================================================================== -->

<h3>ブロック式</h3>

<p>
制御構文などの表記を可能にするため、ブロック式の概念を導入しています。 if や while などの構文や、クラス宣言、リスト・辞書要素の初期化表記も、すべてこの機構を使って実装されています。
</p>

<pre class="code">
f(x:number) {block} = {
    block(x)
    block(x + 1)
    block(x + 2)
}
</pre>

<p>
呼び出し方は以下のようになります。
</p>

<pre class="code">
f(2) {|x|
    print(x)
} # 234
</pre>

<p>
ブロック自体は特殊な変数スコープを持たせた関数オブジェクトで、ブロックパラメータは単に関数への引数になります。ブロックパラメータの操作が周囲に影響を与えることはありません。また、通常の関数オブジェクトで定義できる引数設定 (オプション引数・デフォルト値・可変長引数など) は、ブロックパラメータでも有効です。
</p>

<pre class="code">
x = 0
f(2) {|x|         # dummy arguments are completely isolated from outside
    print(x)
}
println(x)        # 0
</pre>

<p>
ブロックを表すシンボルは何でもかまいません。
</p>

<pre class="code">
f(x:number) {yield} = {
    yield(x)
    yield(x + 1)
    yield(x + 2)
}
</pre>

<p>
シンボルの後にクエスチョンマークをつけたブロックは、オプショナルとして扱われます。この場合、ブロックをつけないで関数を実行すると nil に設定されます。
</p>

<pre class="code">
f_opt() {block?} = {
    if (block == nil) {
        println('not specified')
    } else {
        block()
    }
}

f_opt() # print 'not specified'

f_opt() {
    println('message from block')
}       # print 'message from block'
</pre>

<p>
ブロックは通常、それを実行している関数の「外側」の環境にアクセスできる変数スコープで動作します (「外側」とはレキシカルスコープのそれになりますが、ダイナミックスコープに切り替えることもできます)。関数外部の変数の値を変更することができます。
</p>

<pre class="code">
g() {block} = {
    block()
}

n = 2
g() {
    n = 5
}
printf('n = %d\n', n) # n = 5
</pre>

<p>
ブロックシンボルにアトリビュート :inside_scope をつけると、関数内部のスコープに切り替わり、関数の内部処理で設定される変数などにアクセスできるようになります。関数外部の変数は、参照できた値に対しての改変が可能です。
</p>

<pre class="code">
h() {block:inside_scope} = {
    m = 'local in h()'
    block()
}

h() {
    printf('%s\n', m)    # h()'s local variable m is accessible
}

n = 2
h() {
    n = 5
}
printf('n = %d\n', n)    # n = 2

h() {
    n += 5
}
printf('n = %d\n', n)    # n = 7
</pre>

<p>
quoted value にしたブロックを設定した変数を {|..|} で囲って関数に渡すと、それがブロック本体として扱われます。ブロックパラメータも記述できます。例えば:
</p>

<pre class="code">
f() {block} = {
    block(1, 2, 3, 4)
}
</pre>

<p>
という関数があった場合、以下のふたつの呼び出しは等価です。
</p>

<pre class="code">
block = `{|a, b, c, d|
    printf('%d %d %d %d\n', a, b, c, d)
}
f() {|block|}

f() {|a, b, c, d|
    printf('%d %d %d %d\n', a, b, c, d)
}
</pre>

<p>
ブロックは通常、関数オブジェクトとして扱われますが、シンボルの先頭にバッククオートをつけると quoted value として渡されます。これと、先に示した quoted value をブロック本体として渡す機能を使うと、ブロックの delegation ができます。
</p>

<pre class="code">
f(x:number) {`block} = {
    repeat(x) {|block|}
}
</pre>

<!-- ====================================================================== -->
</td>
</tr>

</table>
</body>
</html>
