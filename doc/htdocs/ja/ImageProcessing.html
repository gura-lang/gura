<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gura Programming Language</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <a href="/"><img src="/images/banner-medium.png" alt="Gura Programming Language/" /></a>
        <p></p>
        <p>
        <a href="../en/ImageProcessing.html" class="radio-off" style="margin-left: 1em">English</a> |
        <a href="../ja/ImageProcessing.html" class="radio-on">Japanese</a>
        </p>
        <p class="view"><a href="/">Top Page</a></p>
        <p class="view"><a href="/ja/Download.html">Download</a></p>
        <p class="view"><a href="/ja/Install.html">Install</a></p>
        <p class="view"><a href="/ja/Gallery.html">Gallery</a></p>
        <!--
        <ul>
          <li><a href="https://github.com/jxg/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jxg/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jxg">View On <strong>GitHub</strong></a></li>
        </ul>
        -->
      </header>
      <section>
<!-- ====================================================================== -->

<h2>グラフィックイメージ処理</h2>

<h3>イメージファイルを読み込んで他のフォーマットに変換</h3>

<p>
JPEG ファイルを PNG ファイルに変換します。
</p>

<pre><code>import(jpeg)
import(png)
I(filename:string) = path.join(sys.datadir, 'sample', 'resource', filename)
image(I('Winter.jpg')).write('Winter.png')
</code></pre>

<h3>イメージファイルを読み込み、グラフィック描画を重ねあわせてファイルに書き出し</h3>

<p>
JPEG ファイルを読み込んだ後、Cairo ライブラリで描画をして、その結果を JPEG ファイルとして書き出します。
</p>

<pre><code>import(jpeg)
import(cairo)
I(filename:string) = path.join(sys.datadir, 'sample', 'resource', filename)
img = image(I('Winter.jpg'))
img.cairo {|cr|
    repeat (10) {|i|
        [x, y, r] = [128 + 30 * i, 128 + 30 * i, 60 - i * 4]
        pat = cairo.pattern_create_radial(
            x - r / 10, y - r / 6, r / 5, x - r / 6, y - r / 6, r * 1.2)
        pat.add_color_stop_rgba(0, 1, 1, 1, 1)
        pat.add_color_stop_rgba(1, 0, 0, 0, 1)
        cr.set_source(pat)
        cr.arc(x, y, r)
        cr.fill()
    }
}
img.write('result.jpg')
</code></pre>

<h3>複数のイメージファイルを結合してアニメーション GIF ファイルを出力</h3>

<p>
GIF ファイルにファイルイメージを結合してアニメーション GIF ファイルを出力します。
</p>

<pre><code>import(gif)
import(png)
gif.content().addimage(['cell1.png', 'cell2.png', 'cell3.png'], 10).write('anim1.gif')
</code></pre>

<p>
動的にイメージを作成して GIF ファイルにすることも可能です。 Cairo でイメージを描画して、アニメーション GIF として出力する例を以下に示します。
</p>

<pre><code>import(cairo)
import(gif)
str = 'Hello'
img = image(`rgba, 64, 64, `white)
gifobj = gif.content()
img.cairo {|cr|
    cr.select_font_face('Georgia', cairo.FONT_SLANT_NORMAL, cairo.FONT_WEIGHT_BOLD)
    cr.set_font_size(64)
    te = cr.text_extents(str)
    cr.set_source_rgb(0.0, 0.0, 0.0)
    for (x in interval(64, -te.width, 30)) {|i|
        img.fill(`white)
        cr.move_to(x, 50)
        cr.show_text(str)
        gifobj.addimage(img.clone(), 10)
    }
}
gifobj.write('anim2.gif')
</code></pre>

<h3>OpenGL による三次元グラフィック</h3>

<p>
OpenGL 1.1 をサポートしています。
描画結果は SDL (Simple Direct Layer) を使ってディスプレイに表示したり、直接イメージファイルに出力することができます。
以下の例は <a href="http://www.wakayama-u.ac.jp/~tokoi/opengl/libglut.html" class="link">GLUT による「手抜き」OpenGL 入門</a> に掲載されていたサンプルを Gura にポーティングしたものです。
</p>

<pre><code>import(glu) {*}
import(opengl) {*}
import(gltester)

vertex = [
    [0, 0, 0], [1, 0, 0], [1, 1, 0], [0, 1, 0]
    [0, 0, 1], [1, 0, 1], [1, 1, 1], [0, 1, 1]
]

init(w:number, h:number) = {
    glClearColor(1, 1, 1, 1)
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT)
    glEnable(GL_DEPTH_TEST, GL_CULL_FACE)
    glEnable(GL_LIGHTING, GL_LIGHT0, GL_LIGHT1)
    glCullFace(GL_FRONT)
    glViewport(0, 0, w, h)
    glMatrixMode(GL_PROJECTION)
    glLoadIdentity()
    gluPerspective(30, w / h, 1, 100)
}

display(degree:number) = {
    glMatrixMode(GL_MODELVIEW)
    glLoadIdentity()
    gluLookAt(3, 4, 5, 0, 0, 0, 0, 1, 0)
    glRotated(degree, 1, 1, 0)
    glMaterialfv(GL_FRONT_AND_BACK,
            GL_AMBIENT_AND_DIFFUSE, [0.8, 0.2, 0.2, 1])
    glBegin(GL_QUADS) {
        glNormal3dv([ 0,  0, -1]), glVertex3dv(vertex[0, 1, 2, 3])
        glNormal3dv([ 1,  0,  0]), glVertex3dv(vertex[1, 5, 6, 2])
        glNormal3dv([ 0,  0,  1]), glVertex3dv(vertex[5, 4, 7, 6])
        glNormal3dv([-1,  0,  0]), glVertex3dv(vertex[4, 0, 3, 7])
        glNormal3dv([ 0, -1,  0]), glVertex3dv(vertex[4, 5, 1, 0])
        glNormal3dv([ 0,  1,  0]), glVertex3dv(vertex[3, 2, 6, 7])
    }
}

degree = 0
[width, height] = [300, 300]
gltester.mainloop(width, height, 0, `idle) {
    `onDraw =&gt; function {
        init(width, height)
        display(degree)
    }
    `onKeyPoll =&gt; %{
        `left =&gt; function { degree += 1 }
        `right =&gt; function { degree -= 1 }
    }
}
</code></pre>

<p>
実行例
</p>

<div><img src="../images/gl-cube.png" /></div>

<p>
<a href="http://www.sgi.com/products/software/opengl/examples/samples/" class="link">SGI</a>
のサンプルをポーティングしたものを、パッケージ中のディレクトリ gura/sample/opengl に収めています。 
</p>

<!-- ====================================================================== -->
      </section>
      <footer>
        <a href="http://sourceforge.jp/">
        <img src="http://sourceforge.jp/sflogo.php?group_id=5586&type=2" alt="SourceForge.JP" />
        </a>
        <!--
        <p>This project is maintained by <a href="https://github.com/jxg">jxg</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
        -->
      </footer>
    </div>
    <script src="/javascripts/scale.fix.js"></script>
  </body>
</html>
