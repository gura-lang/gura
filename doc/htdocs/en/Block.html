<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link href="../stylesheet.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" href="http://gura.sourceforge.jp/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://gura.sourceforge.jp/favicon.ico" type="image/vnd.microsoft.icon" />
<title>Gura Programming Language</title>
<meta name="keywords" content="programming, language, interpreter, mapping, gura,
implicit mapping, member mapping">
</head>
<body>
<div>
<a href="../index.html.en"><img src="../images/banner.png" style="border: none" /></a>
<a href="../en/Block.html" class="radio-on" style="margin-left: 1em">English</a> |
<a href="../ja/Block.html" class="radio-off">Japanese</a>
<span style="margin-left: 3em"><a href="http://sourceforge.jp/">
<img src="http://sourceforge.jp/sflogo.php?group_id=5586&type=3" width="210" height="63" border="0" alt="SourceForge.JP" />
</a></span>
</div>

<div style="color: white; background: #888888; margin-top: 1em; font-weight: bold">
<span style="margin-left: 1em">Copyright (c) 2011-2012 <a href="mailto:pxn11432@nifty.com" style="color:white">Yutaka Saito</a></span>
</div>
<div style="height:.2em; background: #cccccc"></div>
<table cellspacing="0" border="0" width="100%">
<tr>
<td valign="top" class="menu">
<div class="menuitem"><a href="/" class="menuitem">Top Page</a></div>
<div class="menuitem"><a href="Download.html" class="menuitem">Download</a></div>
<div class="menuitem"><a href="Install.html" class="menuitem">Install</a></div>
<div class="menuitem"><a href="Gallery.html" class="menuitem">Gallery</a></div>
<div class="menuitem"><a href="http://sourceforge.jp/forum/forum.php?forum_id=25596" class="menuitem">Gura Forum</a></div>
</td>

<td valign="top" class="description">
<!-- ====================================================================== -->

<h3>Block Expression</h3>

<p>
You can declare functions that has a block expression.
This mechanism is used in variety of ways such as implementation of statements like if and while,
initial declaration of list and dictionary items, and so on.
</p>

<p>
The following is a simple example of declaring a function with a block.
</p>

<pre class="code">
f(x:number) {block} = {
    block(x)
    block(x + 1)
    block(x + 2)
}
</pre>

<p>
You can call it like follows.
</p>

<pre class="code">
f(2) {|x|
    print(x)
} # 234
</pre>

<p>
A block itself is a function object that has a special variable scope.
and it takes a list of block parameter as its arguments.
You can use any argument specifier like optional argument, default values
and variable-length arguments for block parameters as well.
</p>

<pre class="code">
x = 0
f(2) {|x|
    print(x)
}
println(x)        # 0
</pre>

<p>
You can use any symbol to specify the block.
</p>

<pre class="code">
f(x:number) {yield} = {
    yield(x)
    yield(x + 1)
    yield(x + 2)
}
</pre>

<p>
A block specified by a symbol with a question character suffix shall be
treated as an optional one. If the function is called without a block,
that symbol is assigned to nil.
</p>

<pre class="code">
f_opt() {block?} = {
    if (block == nil) {
        println('not specified')
    } else {
        block()
    }
}

f_opt() # print 'not specified'

f_opt() {
    println('message from block')
}       # print 'message from block'
</pre>

<p>
A block usually works with a variable scope that can access to an 'external' environment
of the function.
</p>

<pre class="code">
g() {block} = {
    block()
}

n = 2
g() {
    n = 5
}
printf('n = %d\n', n) # n = 5
</pre>

<!--
ブロックシンボルにアトリビュート :inside_scope をつけると、
関数内部のスコープに切り替わり、関数の内部処理で設定される変数などにアクセスできるようになります。
関数外部の変数は、参照できた値に対しての改変が可能です。

<pre class="code">
h() {block:inside_scope} = {
    m = "local in h()"
    block()
}

h() {
    printf("%s\n", m)    # h()'s local variable m is accessible
}

n = 2
h() {
    n = 5
}
printf("n = %d\n", n)    # n = 2

h() {
    n += 5
}
printf("n = %d\n", n)    # n = 7
</pre>

quoted value にしたブロックを設定した変数を {|..|} で囲って関数に渡すと、それがブロック本体として扱われます。ブロックパラメータも記述できます。例えば:

<pre class="code">
f() {block} = {
    block(1, 2, 3, 4)
}
</pre>

という関数があった場合、以下のふたつの呼び出しは等価です。

<pre class="code">
block = `{|a, b, c, d|
    printf("%d %d %d %d\n", a, b, c, d)
}
f() {|block|}

f() {|a, b, c, d|
    printf("%d %d %d %d\n", a, b, c, d)
}
</pre>

ブロックは通常、関数オブジェクトとして扱われますが、シンボルの先頭にバッククオートをつけると quoted value として渡されます。これと、先に示した quoted value をブロック本体として渡す機能を使うと、ブロックの delegation ができます。

<pre class="code">
f(x:number) {`block} = {
    repeat(x) {|block|}
}
</pre>
-->

<!-- ====================================================================== -->
</td>
</tr>

</table>
</body>
</html>
